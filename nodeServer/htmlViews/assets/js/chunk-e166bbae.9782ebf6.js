(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e166bbae"],{a042:function(e,t,s){"use strict";var a=s("dc1b"),n=s.n(a);n.a},c53d:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"orchestration-task"},[s("base-panel",{attrs:{title:"阶段设置"}},[s("template",{staticClass:"title-right-btns",slot:"title-right"},[s("el-button",{on:{click:e.addPhaseItem}},[e._v("新增阶段")]),s("el-button",{on:{click:e.addTasks}},[e._v("新增任务")]),s("el-button",{on:{click:function(){e.selectedPhases=[]}}},[e._v("清除任务 ")]),s("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("提 交")]),s("el-button",{on:{click:e.back}},[e._v("取 消")])],1),s("el-row",{attrs:{gutter:30}},[s("el-col",{staticClass:"tasks",attrs:{span:5}},[s("el-form",{staticClass:"taskSearch",attrs:{"label-position":"left"}},[s("el-form-item",{attrs:{"label-width":"100px",label:"任务名称："}},[s("el-input",{attrs:{clearable:"",size:"mini"},on:{blur:e.loadData},model:{value:e.queryParams.taskName,callback:function(t){e.$set(e.queryParams,"taskName",t)},expression:"queryParams.taskName"}})],1)],1),s("ul",{staticClass:"businessScenario"},e._l(e.taskList,(function(t,a){return s("li",{key:a,attrs:{draggable:""},on:{dragstart:function(s){return e.dragTasks(t)}}},[e._v(" "+e._s(t.taskName)+" ")])})),0),s("div",{staticStyle:{"text-align":"center"}},[s("el-pagination",{attrs:{small:"","page-count":e.page,"page-size":"10",layout:"prev, pager, next",total:e.total,"pager-count":"5"},on:{"current-change":e.handleCurrentChange}})],1)],1),s("el-col",{attrs:{span:19}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"phasesTitle"},[e._v("阶段")]),s("ul",{staticClass:"phasesContainer"},[e._l(e.phasesList,(function(t,a){return s("li",{key:t.id,staticClass:"phases",attrs:{draggable:""},on:{dragstart:function(s){return e.dragPhases(e.e,t)}}},[e._v(" "+e._s(t.stageName)+" "),s("span",{on:{click:function(s){return e.deletePhases(t,a)}}},[s("i",{staticClass:"el-icon-close"})])])})),s("li",{staticClass:"phases state",on:{click:e.addPhaseItem}},[e._v("阶段+")])],2)]),s("el-col",{attrs:{span:18}},[s("div",{staticClass:"stageTasksResponsesContainer",on:{dragover:function(e){return e.preventDefault()},drop:e.dropItem}},e._l(e.selectedPhases,(function(t,a){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedPhases.length,expression:"selectedPhases.length"}],key:t.id,staticClass:"selectedPhases",attrs:{draggable:""},on:{dragover:function(e){return e.preventDefault()},drop:function(t){return e.dropTaskItem(a)},dragstart:function(s){return e.dragstart(t)},dragenter:function(s){return e.dragenter(t)},dragend:function(s){return e.dragend(t)}}},[s("section",{staticClass:"phasesName"},[e._v(e._s(t.stageName))]),s("section",{staticClass:"phasesTags"},e._l(t.taskList,(function(a,n){return s("el-tag",{key:n,staticClass:"taskList",attrs:{closable:""},on:{close:function(s){return e.handleClose(a,t)}}},[e._v(" "+e._s(a.taskName)+" ")])})),1),s("el-button",{staticClass:"phaseDelete",attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.delPhase(a)}}})],1)})),0)])],1)],1)],1)],2),s("addPhase",{attrs:{visible:e.phaseVisible},on:{cancel:e.cancel,confirm:e.confirmAddPhase}})],1)},n=[],r=(s("4de4"),s("4160"),s("c975"),s("d81d"),s("45fc"),s("a434"),s("159b"),s("2909")),i=s("5530"),c=s("d4ec"),o=s("bee2"),l=s("262e"),u=s("2caf"),d=s("9ab4"),h=s("310e"),p=s.n(h),g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("simple-dialog",{attrs:{dialogTitle:"阶段新增","dialog-visible":e.visible,dialogWidth:"30%","botton-show":"true","close-on-click-modal":!1,"before-close":e.cancelDialog},on:{saveEmit:e.confirm,cancelEmit:e.cancelDialog}},[s("span",[s("el-form",{ref:"phaseFor",attrs:{model:e.phaseForm,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"阶段名称",prop:"stageName"}},[s("el-input",{model:{value:e.phaseForm.stageName,callback:function(t){e.$set(e.phaseForm,"stageName",t)},expression:"phaseForm.stageName"}})],1),s("el-form-item",{attrs:{label:"阶段描述",prop:"stageDesc"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.phaseForm.stageDesc,callback:function(t){e.$set(e.phaseForm,"stageDesc",t)},expression:"phaseForm.stageDesc"}})],1)],1)],1)])},m=[],f=s("60a3"),k=s("5738"),b=function(e){Object(l["a"])(s,e);var t=Object(u["a"])(s);function s(){var e;return Object(c["a"])(this,s),e=t.apply(this,arguments),e.rules={stageName:[{required:!0,message:"请输入阶段名称",trigger:"blur"}],stageDesc:[{required:!0,message:"请选择阶段描述",trigger:"change"}]},e.phaseForm={stageName:"",stageDesc:"",type:"phases"},e}return Object(o["a"])(s,[{key:"confirmAdd",value:function(e){}},{key:"cancelVisible",value:function(){}},{key:"confirm",value:function(){var e=this;this.phaseFor.validate((function(t){if(!t)return console.log("error submit!!"),!1;var s=e.$route.query.scenesId,a=Object(i["a"])({scenesId:s},e.phaseForm);Object(k["b"])(a).then((function(t){console.log(t),t.error?e.$message.error("新增失败:".concat(t.error.message)):(t.data.type="phases",e.confirmAdd(t.data),e.cancelDialog())}))}))}},{key:"cancelDialog",value:function(){this.phaseFor.resetFields(),this.cancelVisible()}}]),s}(f["e"]);Object(d["a"])([Object(f["d"])()],b.prototype,"phaseFor",void 0),Object(d["a"])([Object(f["c"])()],b.prototype,"visible",void 0),Object(d["a"])([Object(f["b"])("confirm")],b.prototype,"confirmAdd",null),Object(d["a"])([Object(f["b"])("cancel")],b.prototype,"cancelVisible",null),b=Object(d["a"])([f["a"]],b);var v=b,y=v,I=s("2877"),P=Object(I["a"])(y,g,m,!1,null,null,null),O=P.exports,j=s("a59a"),L=s("0644"),C=s.n(L),T=function(e){Object(l["a"])(s,e);var t=Object(u["a"])(s);function s(){var e;return Object(c["a"])(this,s),e=t.apply(this,arguments),e.phasesList=[],e.taskList=[],e.selectedPhases=[],e.selectedTaskList=[],e.dragItem={},e.total=0,e.page=1,e.limit=10,e.queryParams={taskName:""},e.phaseVisible=!1,e.draging={},e.target={},e}return Object(o["a"])(s,[{key:"addTasks",value:function(){var e=this.$route.query,t=e.scenesId,s=e.scenesType;this.$router.push({path:"/taskConfigCenter/addTasks",query:{scenesId:t,scenesType:s}})}},{key:"addPhaseItem",value:function(){this.phaseVisible=!0}},{key:"confirmAddPhase",value:function(e){console.log(e),e.id=this.phasesList.length,this.phasesList.push(e)}},{key:"cancel",value:function(){this.phaseVisible=!1}},{key:"deletePhases",value:function(e,t){var s=this,a=this.$route.query.scenesId,n=Object(i["a"])({scenesId:a},e);Object(k["h"])(n).then((function(a){a.error?s.$message.error("删除失败:".concat(a.error.message)):(s.$message.success("删除成功"),s.phasesList.splice(t,1),s.selectedPhases=s.selectedPhases.filter((function(t){return t.stageName!==e.stageName})))}))}},{key:"loadData",value:function(){var e=this,t=this.limit,s=this.page,a=this.queryParams,n=this.$route.query.scenesId,r=Object(i["a"])({scenesId:n,limit:t,page:s},a);Object(j["z"])(r).then((function(t){e.taskList=[],t.error?e.$message.error("访问失败:".concat(t.error.message)):(t.data.rows.map((function(t){var s={taskId:t.id,taskName:t.taskName,type:"task"};e.taskList.push(s)})),e.total=t.data.total)}))}},{key:"handleCurrentChange",value:function(e){this.page=e,this.loadData()}},{key:"getStageTaskByScenesId",value:function(){var e=this,t=this.$route.query.scenesId;this.selectedPhases=[],Object(k["m"])({scenesId:t}).then((function(t){t.error?e.$message.error("获取阶段失败"):(e.phasesList=C()(t.data.stageTasksResponses)||[],e.phasesList&&e.phasesList.length&&e.phasesList.map((function(e){e.type="phases"})),t.data.stageTasksResponses.forEach((function(t){t.taskList.length&&(t.type="phases",e.selectedPhases.push(t),t.taskList.forEach((function(t){t.type="task",e.selectedTaskList.push(t)})))})))}))}},{key:"dragPhases",value:function(e,t){t.taskList=[],this.dragItem=C()(t)}},{key:"dropItem",value:function(e){var t=this;e.stopPropagation(),"phases"===this.dragItem.type&&(this.selectedPhases.some((function(e){return e.stageId===t.dragItem.stageId}))?this.$message.error("禁止拖拽相同阶段"):(this.selectedPhases.push(C()(this.dragItem)),this.dragItem={}))}},{key:"dragTasks",value:function(e){this.dragItem=C()(e)}},{key:"dropTaskItem",value:function(e){var t=this;"task"===this.dragItem.type&&(this.selectedTaskList.some((function(e){return e.taskId===t.dragItem.taskId}))?this.$message.error("禁止拖拽相同任务"):(this.selectedPhases[e].taskList.push(C()(this.dragItem)),this.selectedTaskList.push(C()(this.dragItem)))),this.dragItem={}}},{key:"dragstart",value:function(e){this.target=e}},{key:"dragend",value:function(e){if(this.target!=this.draging){var t=this.selectedPhases.indexOf(this.target),s=this.selectedPhases.indexOf(this.draging),a=Object(r["a"])(this.selectedPhases);a.splice(t,1),a.splice(s,0,this.target),this.selectedPhases=Object(r["a"])(a)}}},{key:"dragenter",value:function(e){this.draging=e}},{key:"confirm",value:function(){var e=this,t=this.$route.query.scenesId,s={scenesId:t,stageTasksResponses:this.selectedPhases};Object(k["t"])(s).then((function(t){t.error?e.$message.error("提交失败"):(e.$message.success("提交成功"),e.$router.back())}))}},{key:"back",value:function(){this.$router.back()}},{key:"handleClose",value:function(e,t){var s=this;t.taskList.forEach((function(s,a){s.taskId===e.taskId&&(console.log(s,a),t.taskList.splice(a,1))})),this.selectedTaskList.forEach((function(t,a){t.taskId===e.taskId&&s.selectedTaskList.splice(a,1)}))}},{key:"delPhase",value:function(e){this.selectedPhases.splice(e,1)}},{key:"created",value:function(){this.loadData(),this.getStageTaskByScenesId()}},{key:"mounted",value:function(){document.body.ondrop=function(e){e.preventDefault(),e.stopPropagation()}}}]),s}(f["e"]);Object(d["a"])([Object(f["d"])()],T.prototype,"parentNode",void 0),T=Object(d["a"])([Object(f["a"])({components:{addPhase:O,draggable:p.a}})],T);var $=T,_=$,N=(s("a042"),Object(I["a"])(_,a,n,!1,null,"4fd7d21e",null));t["default"]=N.exports},dc1b:function(e,t,s){}}]);
//# sourceMappingURL=chunk-e166bbae.9782ebf6.js.map