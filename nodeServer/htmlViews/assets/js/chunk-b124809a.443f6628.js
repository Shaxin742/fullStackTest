(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b124809a"],{"397e":function(e,t,a){"use strict";var s=a("f9fd"),n=a.n(s);n.a},5852:function(e,t,a){"use strict";var s=a("5875"),n=a.n(s);n.a},5875:function(e,t,a){},"6d7b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"task-library-manage"},[a("base-panel",{attrs:{title:"任务库管理"}},[a("template",{slot:"title-right"},[a("el-button",{staticStyle:{"margin-left":"10px"},on:{click:e.back}},[e._v("返回")]),a("el-button",{staticStyle:{"margin-left":"10px"},on:{click:e.editHandler}},[e._v(" 修改办理人 ")]),a("el-button",{staticStyle:{"margin-left":"10px"},on:{click:e.taskManage}},[e._v(" 阶段设置 ")]),a("el-button",{staticStyle:{"margin-left":"10px"},on:{click:e.addTask}},[e._v(" 新增任务 ")])],1),a("div",{staticClass:"task-library-manage-form-con"},[a("el-form",{staticClass:"task-library-manage-form",attrs:{inline:!0,"label-suffix":" :",size:"mini",model:e.queryParams}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入视图名称"},model:{value:e.queryParams.taskName,callback:function(t){e.$set(e.queryParams,"taskName",t)},expression:"queryParams.taskName"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"责任人"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.queryParams.stationUser,callback:function(t){e.$set(e.queryParams,"stationUser",t)},expression:"queryParams.stationUser"}},e._l(e.stationUserOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.user,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",[a("el-checkbox",{model:{value:e.queryParams.isManyOperation,callback:function(t){e.$set(e.queryParams,"isManyOperation",t)},expression:"queryParams.isManyOperation"}},[e._v(" 屏蔽多任务状态 ")])],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.loadData}},[e._v("搜索")]),a("el-button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1)],1),a("el-row",[a("el-form-item",{staticClass:"tagsClass",attrs:{label:"流程标签"}},e._l(e.tagList,(function(t){return a("el-tag",{key:t,class:e.tagsList.some((function(e){return e.tagName===t.tagName}))?"selectedTag":"",on:{click:function(a){return e.selectTag(t)}}},[e._v(" "+e._s(t.tagName)+" ("+e._s(t.num)+") ")])})),1)],1)],1)],1),a("base-table",{staticClass:"sortTable noTableBorder",attrs:{border:"","data-source":e.tableData,loading:e.loading,height:360,columns:e.columns(),"has-pagination":"","show-summary":!1,total:e.total,"current-page":e.page,"page-size":e.limit,"border-style":!0},on:{selectionChange:e.selectionChange,handleCurrent:e.handleCurrent,handleSize:e.handleSize}})],2),a("edit-handler",{attrs:{visible:e.editVisible,data:e.editData},on:{cancelEmit:e.editCancel}})],1)},n=[],i=(a("99af"),a("c740"),a("d81d"),a("45fc"),a("a434"),a("b0c0"),a("d3b7"),a("25f0"),a("5530")),r=a("d4ec"),o=a("bee2"),l=a("262e"),c=a("2caf"),d=a("9ab4"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"修改办理人",visible:e.visible,width:"50%","close-on-click-modal":!1,"before-close":e.calcel},on:{"update:visible":function(t){e.visible=t}}},[a("span",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("div",{staticClass:"title"},[e._v("已选择的任务")]),a("base-table",{staticClass:"sortTable noTableBorder",attrs:{border:"","data-source":e.data,columns:e.columns(),"show-summary":!1,"border-style":!0}}),a("div",{staticClass:"title"},[e._v("请选择您要修改的任务办理人")]),a("span",[e._v("办理人：")]),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dealId,callback:function(t){e.dealId=t},expression:"dealId"}},e._l(e.stationUserOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.user,value:e.id}})})),1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)])},h=[],p=(a("4160"),a("159b"),a("60a3")),g=a("a59a"),f=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.status="",e.dealId="",e.loading=!1,e.stationUserOptions=[],e}return Object(o["a"])(a,[{key:"cancelEdit",value:function(){}},{key:"dataChange",value:function(e){e&&e.length&&this.loadUsers(e)}},{key:"columns",value:function(){return[{prop:"",type:"index",align:"center",label:"序号",width:"60"},{prop:"taskName",label:"任务名称","header-align":"left",showOverflowTooltip:!0,"min-width":"100"},{prop:"taskDesc",label:"任务描述","header-align":"left",showOverflowTooltip:!0,"min-width":"120"},{prop:"taskStationName",label:"责任岗位","header-align":"center",showOverflowTooltip:!0,"min-width":"80"},{prop:"stationUserName",label:"责任人","header-align":"center",showOverflowTooltip:!0,"min-width":"80"},{prop:"status",label:"任务状态","header-align":"center",showOverflowTooltip:!0,"min-width":"80",render:function(e,t){return e("span",t.record.checked?"已启用":"未启用")}},{prop:"stageName",label:"所属阶段","header-align":"center",showOverflowTooltip:!0,"min-width":"80"},{prop:"keyMonitoring",label:"是否关键监控点任务","header-align":"center",align:"center",width:200,showOverflowTooltip:!0,"min-width":"80",render:function(e,t){return e("span",t.record.keyMonitoring?"是":"否")}},{prop:"isMonthlyTarget",label:"是否月度目标","header-align":"center",align:"center",showOverflowTooltip:!0,width:"120",render:function(e,t){return e("span",t.record.isMonthlyTarget?"是":"否")}}]}},{key:"loadUsers",value:function(e){var t=this;this.dealId=e[0].stationUser;var a={stationId:e[0].taskStation,status:"0"};e[0].taskStation?Object(g["t"])(a).then((function(e){t.loading=!0,e.error?t.$message.error("获取办理人失败".concat(e.error.message)):t.stationUserOptions=e.data,t.loading=!1})):this.$message.error("请确认该任务存在责任岗位")}},{key:"confirm",value:function(){var e=this,t=[];this.data.forEach((function(e){t.push(e.id)}));var a="";this.stationUserOptions.forEach((function(t){t.id===e.dealId&&(a=t.user)}));var s={dealId:this.dealId,taskIds:t,dealName:a};Object(g["p"])(s).then((function(t){t.error?e.$message.error("修改失败".concat(t.error.message)):e.cancel()}))}},{key:"cancel",value:function(){this.cancelEdit()}}]),a}(p["e"]);Object(d["a"])([Object(p["b"])("cancelEmit")],f.prototype,"cancelEdit",null),Object(d["a"])([Object(p["c"])()],f.prototype,"visible",void 0),Object(d["a"])([Object(p["c"])()],f.prototype,"data",void 0),Object(d["a"])([Object(p["f"])("data",{deep:!0,immediate:!0})],f.prototype,"dataChange",null),f=Object(d["a"])([p["a"]],f);var m=f,b=m,v=(a("5852"),a("2877")),y=Object(v["a"])(b,u,h,!1,null,"40386354",null),k=y.exports,w=a("2ef0"),O=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.tableData=[],e.total=0,e.page=1,e.limit=10,e.loading=!1,e.selections=[],e.editVisible=!1,e.editData=[],e.queryParams={taskName:"",stationUser:"",tags:[],isManyOperation:!1},e.tagsList=[],e.taskName="",e.stationUserOptions=[],e.tagList=[],e}return Object(o["a"])(a,[{key:"columns",value:function(){var e=this;return[{prop:"",type:"selection",label:"序号",width:"60"},{prop:"",type:"index",align:"center",label:"序号",width:"60"},{prop:"taskName",label:"任务名称","header-align":"left",showOverflowTooltip:!0,"min-width":"100"},{prop:"taskDesc",label:"任务描述","header-align":"left",showOverflowTooltip:!0,"min-width":"120"},{prop:"taskStationName",label:"责任岗位","header-align":"left",showOverflowTooltip:!0,"min-width":"80"},{prop:"stationUserName",label:"责任人","header-align":"left",showOverflowTooltip:!0,"min-width":"80"},{prop:"status",label:"任务状态","header-align":"left",showOverflowTooltip:!0,"min-width":"80",render:function(e,t){return e("span",t.record.checked?"已启用":"未启用")}},{prop:"stageName",label:"所属阶段","header-align":"left",showOverflowTooltip:!0,"min-width":"80"},{prop:"keyMonitoring",label:"是否关键监控点任务","header-align":"left",align:"left",width:200,showOverflowTooltip:!0,"min-width":"80",render:function(e,t){return e("span",t.record.keyMonitoring?"是":"否")}},{prop:"isMonthlyTarget",label:"是否月度目标","header-align":"left",align:"left",showOverflowTooltip:!0,"min-width":"80",render:function(e,t){return e("span",t.record.isMonthlyTarget?"是":"否")}},{align:"center",label:"操作",width:"300",headerAlign:"center",render:function(t,a){var s=a.record,n=[{name:"修改办理人",action:"editHandler"},{name:"删除",action:"delRow"}];return t("div",{},[t("el-button",{props:{type:"text"},on:{click:function(){return e.edit(s)}}},"修改"),t("span",{style:{padding:"0 6px"}},"|"),t("el-button",{props:{type:"text"},on:{click:function(){return e.copy(s)}}},"复制"),t("span",{style:{padding:"0 6px"}},"|"),t("el-button",{props:{type:"text"},on:{click:function(){return e.useIt(s)}}},s.checked?"停用":"启用"),t("span",{style:{padding:"0 6px"}},"|"),t("el-dropdown",{on:{command:e.handleCommand.bind(e,s)},props:{trigger:"click"}},[t("el-button",{props:{type:"text"}},["更多",t("svg-icon",{props:{iconClass:"icon_down_backups"},class:"icon"})]),t("el-dropdown-menu",{slot:"dropdown"},n.map((function(e){return t("el-dropdown-item",{props:{command:e.action}},e.name)})))])])}}]}},{key:"addTask",value:function(){var e=this.$route.query,t=e.scenesId,a=e.scenesType;this.$router.push({path:"/taskConfigCenter/addTasks",query:{scenesId:t,scenesType:a}})}},{key:"editHandler",value:function(e){var t=this;if(this.editData=[],this.selections.length){var a=this.selections.some((function(e){e.taskStation,t.selections[0].taskStation}));a?(this.editData=this.selections,this.editVisible=!0):this.$message.error("请确认所有任务都为同一责任岗位")}else if("[object Object]"===Object.prototype.toString.call(e)){var s=[];s.push(e),this.editData=s,this.editVisible=!0}}},{key:"editCancel",value:function(){this.editVisible=!1,this.loadData()}},{key:"selectionChange",value:function(e){this.selections=e}},{key:"loadData",value:function(){var e=this;this.loading=!0;var t=this.limit,a=this.page,s=this.queryParams,n=this.$route.query.scenesId;s.tags=[],this.tagsList.map((function(e){s.tags.push(e.tagName)}));var r=Object(i["a"])({scenesId:n,limit:t,page:a},s);Object(g["z"])(r).then((function(t){t.error?e.$message.error("任务列表访问失败:".concat(t.error.message)):(e.tableData=t.data.rows,e.total=t.data.total),e.loading=!1}))}},{key:"loadTags",value:function(){var e=this;this.tagList=[];var t=this.$route.query.scenesId;Object(g["x"])({sceneId:t}).then((function(t){t.error?e.$message.error("获取标签失败:".concat(t.error.message)):e.tagList=e.tagList.concat(t.data)}))}},{key:"loadDicts",value:function(){var e=this;Object(g["o"])().then((function(t){t.error?e.$message.error("获取责任人失败:".concat(t.error.message)):e.stationUserOptions=t.data}))}},{key:"edit",value:function(e){var t=e.id,a=this.$route.query,s=a.scenesId,n=a.scenesType;this.$router.push({path:"/taskConfigCenter/addTasks",query:{id:t,scenesId:s,scenesType:n}})}},{key:"copy",value:function(e){var t=this;this.loading=!0;var a=e.id,s=this.$route.query,n=s.scenesId,i=s.scenesType;Object(g["j"])({id:a}).then((function(e){e.error?(t.loading=!1,t.$message.error("复制失败:".concat(e.error.message))):(t.loading=!1,t.$router.push({path:"/taskConfigCenter/addTasks",query:{id:e.data,scenesId:n,scenesType:i}}))}))}},{key:"useIt",value:function(e){var t=this,a=0===e.checked?"启用":"停用";Object(g["r"])({id:e.id}).then((function(s){s.error?t.$message.error("".concat(a,"失败:").concat(s.error.message)):(e.checked=(e.checked+1)%2,t.$message.success("".concat(a,"成功")))}))}},{key:"delRow",value:function(e){var t=this,a=e.id;Object(g["l"])({id:a}).then((function(e){e.error?t.$message.error("删除失败:".concat(e.error.message)):t.loadData()}))}},{key:"handleCurrent",value:function(e){this.page=e,this.loadData()}},{key:"handleSize",value:function(e){this.limit=e,this.page=1,this.loadData()}},{key:"selectTag",value:function(e){if("全部"===e.tagName)this.tagsList.length===this.tagList.length?this.tagsList=[]:this.tagsList=Object(w["cloneDeep"])(this.tagList);else{console.log(e);var t=this.tagsList.findIndex((function(t){return t.tagName===e.tagName}));if(console.log(t),-1===t)this.tagsList.push(e),this.tagsList.length===this.tagList.length-1&&this.tagsList.push({tagName:"全部",num:this.total});else{this.tagsList.splice(t,1);var a=this.tagsList.findIndex((function(e){return"全部"===e.tagName}));-1!==a&&this.tagsList.splice(a,1)}}this.loadData()}},{key:"handleReset",value:function(){this.queryParams={taskName:"",stationUser:"",tags:[],isManyOperation:!1},this.loadData()}},{key:"taskManage",value:function(){var e=this.$route.query,t=e.scenesId,a=e.scenesType;this.$router.push({path:"/taskConfigCenter/orchestrationTask",query:{scenesId:t,scenesType:a}})}},{key:"handleCommand",value:function(e,t){this[t](e)}},{key:"back",value:function(){this.$router.push("/taskConfigCenter/businessScenarioManage")}},{key:"created",value:function(){this.loadData(),this.loadTags(),this.loadDicts()}}]),a}(p["e"]);O=Object(d["a"])([Object(p["a"])({components:{editHandler:k}})],O);var T=O,j=T,C=(a("397e"),Object(v["a"])(j,s,n,!1,null,"28c001d8",null));t["default"]=C.exports},f9fd:function(e,t,a){}}]);
//# sourceMappingURL=chunk-b124809a.443f6628.js.map