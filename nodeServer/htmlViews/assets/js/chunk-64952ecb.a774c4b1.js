(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64952ecb"],{"2db3":function(e,t,a){},5954:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("base-panel",{directives:[{name:"loading",rawName:"v-loading",value:e.testloading,expression:"testloading"}],attrs:{title:"新增http服务类型数据视图",actions:e.actions()}},[a("el-form",{ref:"form",staticClass:"formDataHorizontal formCss labelSuffix",attrs:{model:e.form,"label-position":"left","label-suffix":"：","label-width":"100px",rules:e.rulesForm}},[a("el-form-item",{attrs:{label:"视图名称",prop:"viewName"}},[a("el-input",{attrs:{placeholder:"请输入视图名称"},model:{value:e.form.viewName,callback:function(t){e.$set(e.form,"viewName",t)},expression:"form.viewName"}})],1),a("el-form-item",{attrs:{label:"服务连接器",prop:"serverConnect"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择服务连接器"},on:{change:e.connectFrom},model:{value:e.form.serverConnect,callback:function(t){e.$set(e.form,"serverConnect",t)},expression:"form.serverConnect"}},e._l(e.serverConnectList,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})})),1),a("el-button",{staticClass:"create_button",attrs:{icon:"el-icon-plus"},on:{click:e.newDialog}},[e._v("新增")])],1),1!==e.subTypeVal?a("el-form-item",{attrs:{label:"请求path",prop:"pathAsk"}},[a("el-input",{attrs:{placeholder:"请输入请求path"},model:{value:e.form.pathAsk,callback:function(t){e.$set(e.form,"pathAsk",t)},expression:"form.pathAsk"}})],1):e._e(),1!==e.subTypeVal?a("el-form-item",{attrs:{label:"请求方式",prop:"reqModel"}},[a("el-select",{model:{value:e.form.reqModel,callback:function(t){e.$set(e.form,"reqModel",t)},expression:"form.reqModel"}},e._l(e.httpMethods,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),0!==e.subTypeVal?a("el-form-item",{attrs:{label:"请求方法名",prop:"askMethod"}},[a("el-input",{model:{value:e.form.askMethod,callback:function(t){e.$set(e.form,"askMethod",t)},expression:"form.askMethod"}})],1):e._e(),a("el-form-item",{attrs:{label:"数据字典",prop:"dataDictionary"}},[a("el-switch",{attrs:{"active-value":0,"inactive-value":1},model:{value:e.form.dataDictionary,callback:function(t){e.$set(e.form,"dataDictionary",t)},expression:"form.dataDictionary"}})],1)],1),a("simple-card",{attrs:{actions:e.paramsActions(),title:"参数列表"}},[a("parameView",{ref:"parameViewTable",attrs:{"parameter-data":e.listData,"is-compatible":e.isCompatible,dictFlag:e.form.dataDictionary}})],1),a("simple-card",{attrs:{title:"字段列表"}},[a("treeTableList",{ref:"treeLists",attrs:{"edit-tree":e.editTree,testChange:e.testChange,isCompatible:e.isCompatible,"data-list":e.productTreeData,"has-tree":!0}})],1),a("simple-card",{attrs:{title:"报文内容预览"}},[a("pre",{staticStyle:{width:"100%",height:"200px",border:"1px solid #E1E4EB",background:"#F5F6FA",overflow:"auto","border-radius":"2px"}},[e._v(e._s(e.textResult))])])],1),a("createDialog",{attrs:{"dialog-title":"新建服务连接器","dialog-visible":e.dialogVisibleBool,"dialog-width":"600px","botton-show":"true",type:"1","save-text":"保存","cancel-text":"取消"},on:{saveEmit:e.saveDialog,cancelEmit:e.cancelDialog}}),a("testEditor",{ref:"advance",attrs:{"dialog-test-switch":e.dialogSwitch,"params-list":e.listData},on:{saveEmitSwitch:e.treeDataTest,cancelEmitSwitch:e.cancelSwitch}})],1)},i=[],o=(a("a4d3"),a("e01a"),a("4160"),a("45fc"),a("b0c0"),a("159b"),a("2909")),s=a("d4ec"),l=a("bee2"),n=a("262e"),d=a("2caf"),c=a("9ab4"),p=a("60a3"),u=a("2ef0"),m=a("7504"),f=a("1e45"),h=a("d7e7"),v=a("5b71"),g=a("12ec"),b=a("cb9b"),y=a("ed5d"),k=function(e){Object(n["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.subTypeVal=0,e.testloading=!1,e.editTree=[],e.updateId="",e.testChange=!1,e.serverConnectList=[],e.httpMethods=[{label:"GET",value:1},{label:"POST",value:0}],e.rulesForm={viewName:{required:!0,message:"请输入视图名称",trigger:"blur"},serverConnect:{required:!0,message:"请选择服务连接器",trigger:"change"},pathAsk:{required:!0,message:"请输入请求path",trigger:"blur"},askMethod:{required:!0,message:"请求方法名",trigger:"blur"},reqModel:{required:!0,message:"请求方式",trigger:"blur"}},e.conRules={conName:{required:!0,message:"请输入连接器名称",trigger:"blur"},conType:{required:!0,message:"请选择连接器类型",trigger:"change"},address:{required:!0,validator:function(t,a,r){var i=/\?wsdl$/,o=/((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5]):([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-4]\d{4}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$)|(^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$)/;return a?"1"===e.connector.conType?i.test(a)?r():r(new Error("请输入以'?wsdl'结尾服务器地址")):"0"===e.connector.conType?o.test(a)?r():r(new Error("注意服务地址只应该包括IP+端口号或者域名")):r(new Error("请先选择连接器类型")):r(new Error("请输入服务器地址"))},trigger:"blur"}},e.dialogSwitch=!1,e.productTreeData=[],e.form={viewName:"",pathAsk:"",reqModel:0,serverConnect:"",askMethod:"",dataDictionary:!1},e.connector={conName:"",conType:"",address:"",status:""},e.isCompatible="",e.textResult="",e.rightText="关闭",e.dialogVisibleBool=!1,e.listData=[{id:1,code:"",name:"",type:"",required:"",defaultValue:"",edits:[0,1,1,1,1,1,0],addButton:!0}],e}return Object(l["a"])(a,[{key:"actions",value:function(){var e=this;return[{icon:"",onClick:e.dataViewAddSure,type:"primary",title:"确定"},{icon:"",onClick:function(){e.$router.back()},type:"button",title:"取消"}]}},{key:"paramsActions",value:function(){var e=this;return[{title:"测试查询",icon:"stack-line",onClick:e.treeDialog}]}},{key:"created",value:function(){this.$route.query.id&&this.dataViewDetail(),this.linkListData()}},{key:"dataViewDetail",value:function(){var e=this;this.isCompatible=this.$route.query.isCompatible,this.updateId=this.$route.query.id;var t=this.$route.query.id;Object(b["d"])(t).then((function(t){var a=t.data;e.form.viewName=a.name,e.form.pathAsk=a.path,e.form.reqModel=a.reqModel,e.form.serverConnect=a.linkId,e.form.askMethod=a.methodName,e.form.dataDictionary=a.dictFlag,a.queryParams&&(e.listData=a.queryParams);var r=Object(u["cloneDeep"])(a.fields);r.forEach((function(e){e.foreignFieldCode&&(e.treeCode=!0)})),e.editTree=r,e.productTreeData=a.fields}))}},{key:"newDialog",value:function(){this.dialogVisibleBool=!0}},{key:"linkListData",value:function(){var e=this,t={page:1,limit:1e4,type:"1",name:""};Object(b["o"])(t).then((function(t){t.error?e.$message.error(t.error.message):e.serverConnectList=t.data.rows}))}},{key:"saveDialog",value:function(e){var t=this;Object(b["a"])(e).then((function(e){e.error?t.$message.error(e.error.message):(t.dialogVisibleBool=!1,t.cancelDialog(),t.linkListData())}))}},{key:"cancelDialog",value:function(){this.dialogVisibleBool=!1}},{key:"treeDataTest",value:function(e){var t=this;this.testloading=!0;var a=[];if("dialogClose"!==e)for(var r in this.dialogSwitch=!1,this.$refs.advance["spread"].model)a.push({code:r,value:this.$refs.advance["spread"].model[r]});else a=[];var i={path:this.form.pathAsk,reqModel:this.form.reqModel,methodName:this.form.askMethod,linkId:this.form.serverConnect,type:1,queryParams:a};Object(b["s"])(i).then((function(e){if(t.$message.success("测试查询成功"),e.error)t.testloading=!1,t.$message.error(e.error.message);else if(e.data.result?t.textResult=JSON.parse(y["a"].decode(e.data.result)):t.textResult=e.data.result,e.data.jsonSchema){var a=t.treeHandle(e.data.jsonSchema);t.productTreeData=a,t.test(a)}else t.productTreeData=e.data.jsonSchema;t.testloading=!1}))}},{key:"test",value:function(e){var t=this,a=[];e.forEach((function(e){t.editTree.forEach((function(t){e.fieldCode!==t.fieldCode&&a.push(e.fieldCode)}))})),a.length>0&&this.$confirm("是否保留测试查询之前的字段列表数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.productTreeData=e})).catch((function(){t.testChange=!0,t.productTreeData=e}))}},{key:"treeHandle",value:function(e){var t=[];if(e.type&&"array"===e.type)e.items&&t.push.apply(t,Object(o["a"])(this.treeHandle(e.items)));else for(var a in e.properties)"object"===e.properties[a].type?t.push({fieldCode:a,fieldName:"",fieldType:"",type:e.properties[a].type,description:e.properties[a].description,children:this.treeHandle(e.properties[a])}):"array"===e.properties[a].type?e.properties[a].items&&t.push({fieldCode:a,fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].type,description:e.properties[a].description,children:[{fieldCode:"items",fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].items.type,description:e.properties[a].items.description,children:this.treeHandle(e.properties[a].items)}]}):t.push({fieldCode:a,fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].type,description:e.properties[a].description,children:[]});return t}},{key:"treeDialog",value:function(){var e=this,t=this.$refs["form"];t.validate((function(t){if(t)if(0===e.listData.length)e.treeDataTest("dialogClose");else{var a=e.listData.some((function(e){if(e.code)return!0}));a?e.dialogSwitch=!0:e.treeDataTest("dialogClose")}else e.$message.error("请先完成基本信息输入！")}))}},{key:"cancelSwitch",value:function(){this.$refs.advance["spread"].model="",this.dialogSwitch=!1}},{key:"dataViewAddSure",value:function(){var e=this;console.log(" this.listData",this.listData);var t=this.$refs["form"],a=this.$refs.treeLists["treeDataList"];t.validate((function(r){var i=!1;if(!r)return!1;if(e.productTreeData=a,console.log(" this.listData",e.listData),e.listData=e.$refs.parameViewTable["parameterData"],i=Object(v["a"])(e.listData,e.productTreeData),console.log("checkFlag",i),!1===i){var o={name:e.form.viewName,kind:1,type:0,dictFlag:e.form.dataDictionary,linkId:e.form.serverConnect,path:e.form.pathAsk,reqModel:e.form.reqModel,methodName:e.form.askMethod,fields:e.productTreeData,respCodes:[]};e.listData.length>0&&e.listData[0].code?o.queryParams=e.listData:o.queryParams=[],"0"===e.isCompatible&&e.updateId||"1"===e.isCompatible&&e.updateId?(o.id=e.updateId,o.isCompatible=e.isCompatible,Object(b["t"])(o).then((function(a){t.resetFields(),a.error?e.$message.error(a.error.message):(e.$message.success("修改http服务型数据视图成功"),e.$router.back())}))):Object(b["c"])(o).then((function(a){t.resetFields(),a.error?e.$message.error(a.error.message):(e.$message.success("新增http服务型数据视图成功"),e.$router.back())}))}}))}},{key:"connectFrom",value:function(e){var t=this;this.serverConnectList.forEach((function(a){a.id===e&&(t.subTypeVal=a.subType)}))}}]),a}(p["e"]);k=Object(c["a"])([Object(p["a"])({components:{testEditor:m["a"],treeTableList:h["a"],parameView:g["a"],createDialog:f["a"]}})],k);var D=k,w=D,C=(a("7a1e"),a("2877")),T=Object(C["a"])(w,r,i,!1,null,"46e7d541",null);t["default"]=T.exports},"7a1e":function(e,t,a){"use strict";var r=a("2db3"),i=a.n(r);i.a}}]);
//# sourceMappingURL=chunk-64952ecb.a774c4b1.js.map