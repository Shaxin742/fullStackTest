(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0487232c"],{5577:function(e,t,a){"use strict";var r=a("d59f"),i=a.n(r);i.a},8058:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("base-panel",{directives:[{name:"loading",rawName:"v-loading",value:e.testloading,expression:"testloading"}],attrs:{title:"新增数据推送服务",actions:e.actions()}},[a("el-form",{ref:"form",staticClass:"formDataHorizontal formCss labelSuffix",attrs:{model:e.form,"label-position":"left","label-suffix":"：","label-width":"100px",rules:e.rulesForm}},[a("el-form-item",{attrs:{label:"服务名称",prop:"viewName"}},[a("el-input",{attrs:{placeholder:"请输入推送服务名称"},model:{value:e.form.viewName,callback:function(t){e.$set(e.form,"viewName",t)},expression:"form.viewName"}})],1),1!==e.subTypeVal?a("el-form-item",{attrs:{label:"请求path",prop:"pathAsk"}},[a("el-input",{attrs:{placeholder:"请输入请求path"},model:{value:e.form.pathAsk,callback:function(t){e.$set(e.form,"pathAsk",t)},expression:"form.pathAsk"}})],1):e._e(),a("el-form-item",{attrs:{label:"服务连接器",prop:"serverConnect"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择服务连接器"},on:{change:e.connectFrom},model:{value:e.form.serverConnect,callback:function(t){e.$set(e.form,"serverConnect",t)},expression:"form.serverConnect"}},e._l(e.serverConnectList,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})})),1),a("el-button",{staticClass:"create_button",attrs:{icon:"el-icon-plus"},on:{click:e.newDialog}},[e._v("新增")])],1),0!==e.subTypeVal?a("el-form-item",{attrs:{label:"请求方法名",prop:"askMethod"}},[a("el-input",{model:{value:e.form.askMethod,callback:function(t){e.$set(e.form,"askMethod",t)},expression:"form.askMethod"}})],1):e._e()],1),a("simple-card",{attrs:{title:"参数列表",actions:e.paramsActions()}},[a("parameView",{ref:"parameViewTable",attrs:{"parameter-data":e.listData,"is-compatible":e.isCompatible,dictFlag:e.form.dataDictionary}})],1),a("simple-card",{attrs:{title:"字段列表"}},[a("treeTableList",{ref:"treeLists",attrs:{isCompatible:e.isCompatible,"edit-tree":e.editTree,testChange:e.testChange,"data-list":e.productTreeData,"has-tree":!0}})],1),a("simple-card",{attrs:{title:"报文内容预览"}},[a("pre",{staticStyle:{width:"100%",height:"200px",border:"1px solid #E1E4EB",background:"#F5F6FA",overflow:"auto","border-radius":"2px"}},[e._v(e._s(e.textResult))])])],1),a("createDialog",{attrs:{"dialog-title":"新建服务连接器","dialog-visible":e.dialogVisibleBool,"dialog-width":"600px","botton-show":"true",type:"1","save-text":"保存","cancel-text":"取消"},on:{saveEmit:e.saveDialog,cancelEmit:e.cancelDialog}}),a("testEditor",{ref:"advance",attrs:{"dialog-test-switch":e.dialogSwitch,"params-list":e.listData},on:{saveEmitSwitch:e.treeDataTest,cancelEmitSwitch:e.cancelSwitch}})],1)},i=[],s=(a("a4d3"),a("e01a"),a("4160"),a("45fc"),a("b0c0"),a("159b"),a("2909")),o=a("d4ec"),l=a("bee2"),n=a("262e"),c=a("2caf"),d=a("9ab4"),p=a("60a3"),u=a("1e45"),m=a("7504"),f=a("5b71"),h=a("d7e7"),v=a("12ec"),g=a("cb9b"),b=a("ed5d"),y=function(e){Object(n["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(o["a"])(this,a),e=t.apply(this,arguments),e.subTypeVal=0,e.testloading=!1,e.editTree=[],e.updateId="",e.serverConnectList=[],e.rulesForm={viewName:{required:!0,message:"请输入视图名称",trigger:"blur"},serverConnect:{required:!0,message:"请选择服务连接器",trigger:"change"},pathAsk:{required:!0,message:"请输入请求path",trigger:"blur"},askMethod:{required:!0,message:"请求方法名",trigger:"blur"}},e.conRules={conName:{required:!0,message:"请输入连接器名称",trigger:"blur"},conType:{required:!0,message:"请选择连接器类型",trigger:"change"},address:{required:!0,validator:function(t,a,r){var i=/\?wsdl$/,s=/((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5]):([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-4]\d{4}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$)|(^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$)/;return a?"1"===e.connector.conType?i.test(a)?r():r(new Error("请输入以'?wsdl'结尾服务器地址")):"0"===e.connector.conType?s.test(a)?r():r(new Error("注意服务地址只应该包括IP+端口号或者域名")):r(new Error("请先选择连接器类型")):r(new Error("请输入服务器地址"))},trigger:"blur"}},e.dialogSwitch=!1,e.productTreeData=[],e.form={viewName:"",pathAsk:"",serverConnect:"",askMethod:"",dataDictionary:"1"},e.connector={conName:"",conType:"",address:"",status:""},e.isCompatible="",e.textResult="",e.rightText="关闭",e.testChange=!1,e.dialogVisibleBool=!1,e.listData=[{id:1,code:"",name:"",type:"",required:"",defaultValue:"",edits:[0,1,1,1,1,1,1,0],addButton:!0}],e}return Object(l["a"])(a,[{key:"actions",value:function(){var e=this;return[{icon:"",onClick:e.dataViewAddSure,type:"primary",title:"确定"},{icon:"",onClick:function(){e.$router.back()},type:"button",title:"取消"}]}},{key:"paramsActions",value:function(){var e=this;return[{title:"测试查询",icon:"stack-line",onClick:e.treeDialog}]}},{key:"created",value:function(){this.$route.query.id&&this.dataViewDetail(),this.linkListData()}},{key:"dataViewDetail",value:function(){var e=this;this.isCompatible=this.$route.query.isCompatible,this.updateId=this.$route.query.id;var t=this.$route.query.id;Object(g["d"])(t).then((function(t){var a=t.data;e.form.viewName=a.name,e.form.pathAsk=a.path,e.form.serverConnect=a.linkId,e.form.askMethod=a.methodName,e.form.dataDictionary=a.dictFlag,a.queryParams?e.listData=a.queryParams:e.listData=[],e.editTree=a.fields,e.productTreeData=a.fields}))}},{key:"newDialog",value:function(){this.dialogVisibleBool=!0}},{key:"linkListData",value:function(){var e=this,t={page:1,limit:1e4,type:"1",name:""};Object(g["o"])(t).then((function(t){t.error?e.$message.error(t.error.message):e.serverConnectList=t.data.rows}))}},{key:"saveDialog",value:function(e){var t=this;Object(g["a"])(e).then((function(e){e.error?t.$message.error(e.error.message):(t.dialogVisibleBool=!1,t.cancelDialog(),t.linkListData())}))}},{key:"cancelDialog",value:function(){this.dialogVisibleBool=!1}},{key:"treeDataTest",value:function(e){var t=this;this.testloading=!0;var a=[];if("dialogClose"!==e)for(var r in this.dialogSwitch=!1,this.$refs.advance["spread"].model)a.push({code:r,value:this.$refs.advance["spread"].model[r]});else a=[];var i={path:this.form.pathAsk,methodName:this.form.askMethod,linkId:this.form.serverConnect,type:0,queryParams:a};Object(g["s"])(i).then((function(e){if(e.error)t.$message.error(e.error.message);else{if(e.data.result?t.textResult=JSON.parse(b["a"].decode(e.data.result)):t.textResult=e.data.result,e.data.jsonSchema){var a=t.treeHandle(e.data.jsonSchema);t.productTreeData=a,t.test(a)}else t.productTreeData=e.data.jsonSchema;t.$message.success("测试查询成功")}t.testloading=!1}))}},{key:"test",value:function(e){var t=this,a=[];e.forEach((function(e){t.editTree.forEach((function(t){e.fieldCode!==t.fieldCode&&a.push(e.fieldCode)}))})),a.length>0&&this.$confirm("是否保留测试查询之前的字段列表数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.productTreeData=e})).catch((function(){t.testChange=!0,t.productTreeData=e}))}},{key:"treeHandle",value:function(e){var t=[];if(e.type&&"array"===e.type)e.items&&t.push.apply(t,Object(s["a"])(this.treeHandle(e.items)));else for(var a in e.properties)"object"===e.properties[a].type?t.push({fieldCode:a,fieldName:"",fieldType:"",type:e.properties[a].type,description:e.properties[a].description,children:this.treeHandle(e.properties[a])}):"array"===e.properties[a].type?e.properties[a].items&&t.push({fieldCode:a,fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].type,description:e.properties[a].description,children:[{fieldCode:"items",fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].items.type,description:e.properties[a].items.description,children:this.treeHandle(e.properties[a].items)}]}):t.push({fieldCode:a,fieldName:"",fieldType:"",isPrimaryKey:1,type:e.properties[a].type,description:e.properties[a].description,children:[]});return t}},{key:"treeDialog",value:function(){var e=this,t=this.$refs["form"];t.validate((function(t){if(t)if(0===e.listData.length)e.treeDataTest("dialogClose");else{var a=e.listData.some((function(e){return!!e["code"]}));a?e.dialogSwitch=!0:e.treeDataTest("dialogClose")}else e.$message.error("请先完成基本信息输入！")}))}},{key:"cancelSwitch",value:function(){this.$refs.advance["spread"].model="",this.dialogSwitch=!1}},{key:"dataViewAddSure",value:function(){var e=this,t=this.$refs["form"],a=this.$refs.treeLists["treeDataList"];t.validate((function(r){var i=!1;if(!r)return!1;if(e.productTreeData=a,e.listData=e.$refs.parameViewTable["parameterData"],i=Object(f["a"])(e.listData,e.productTreeData),console.log(" this.listData ",e.listData),!1===i){var s={name:e.form.viewName,kind:1,type:1,dictFlag:e.form.dataDictionary,linkId:e.form.serverConnect,path:e.form.pathAsk,methodName:e.form.askMethod,fields:e.productTreeData,respCodes:[]};e.listData.length>0&&e.listData[0].code?s.queryParams=e.listData:s.queryParams=[],"0"===e.isCompatible&&e.updateId||"1"===e.isCompatible&&e.updateId?(s.id=e.updateId,s.isCompatible=e.isCompatible,Object(g["t"])(s).then((function(a){t.resetFields(),a.error?e.$message.error(a.error.message):(e.$message.success("修改数据推送视图成功"),e.$router.back())}))):Object(g["c"])(s).then((function(a){t.resetFields(),a.error?e.$message.error(a.error.message):(e.$message.success("新增数据推送数据视图成功"),e.$router.back())}))}}))}},{key:"connectFrom",value:function(e){var t=this;this.serverConnectList.forEach((function(a){a.id===e&&(t.subTypeVal=a.subType)}))}}]),a}(p["e"]);y=Object(d["a"])([Object(p["a"])({components:{testEditor:m["a"],treeTableList:h["a"],parameView:v["a"],createDialog:u["a"]}})],y);var k=y,D=k,w=(a("5577"),a("2877")),C=Object(w["a"])(D,r,i,!1,null,"03a78c00",null);t["default"]=C.exports},d59f:function(e,t,a){}}]);
//# sourceMappingURL=chunk-0487232c.d67171e2.js.map