(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a850335"],{"4fee":function(t,e,a){"use strict";var i=a("7930"),s=a.n(i);s.a},"6a2d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-info-mamager"},[a("base-panel",{attrs:{title:"用户详情"}},[a("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("note-card",{attrs:{title:"用户基本信息",shadow:""}},[a("div",{staticClass:"info-wrap user-info"},[a("div",{staticClass:"user-info-avatar"},[t.userInfos.headImg?a("img",{attrs:{src:t.userInfos.headImg,alt:""}}):a("span",{staticClass:"head-portrait"},[t._v(t._s(t.userInfos.username.slice(-1)))])]),a("div",{staticClass:"user-info-name"},[a("p",{staticClass:"user-name"},[t._v(t._s(t.userInfos.username)+" "),a("span",[t._v(t._s(t.userInfos.usercode))]),0===t.userInfos.locked?a("el-tag",{staticClass:"radius-tag active"},[t._v("正常")]):1===t.userInfos.locked?a("el-tag",{staticClass:"radius-tag locked"},[t._v("已锁定")]):t._e()],1),a("p",{staticClass:"user-email"},[t._v(t._s(t.userInfos.email))])]),a("ul",{staticClass:"user-info-detail"},[a("li",[a("span",{staticClass:"label"},[t._v("所属部门：")]),t.userInfos.deptName?a("span",[t._v(t._s(t.userInfos.deptName))]):t._e()]),a("li",[a("span",{staticClass:"label"},[t._v("IP地址：")]),a("span",[t._v(t._s(t.userInfos.ipAddress))])]),a("li",[a("span",{staticClass:"label"},[t._v("最新登录时间：")]),a("span",[t._v(t._s(t.userInfos.lastLoginTime))])])])])])],1),a("el-col",{attrs:{span:9}},[a("note-card",{attrs:{title:"菜单权限",shadow:""}},[a("div",{staticStyle:{height:"240px","overflow-y":"auto"}},[a("el-tree",{key:"tree",ref:"tree",attrs:{data:t.userTrees,"node-key":"id",props:t.defaultProps,"default-expand-all":!0},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,s=e.data;return a("div",{staticClass:"info-item"},[a("div",{staticClass:"label"},[a("span",{staticClass:"menu-title"},[t._v(t._s(i.label))])]),s.children&&0!==s.children.length?t._e():a("div",{staticClass:"content action"},[s&&s.actions?a("el-row",t._l(s.actions,(function(e){return a("el-col",{key:e.id,staticClass:"box-col",attrs:{span:4}},[a("span",[t._v(t._s(e.name))])])})),1):t._e()],1)])}}])})],1)])],1),a("el-col",{attrs:{span:9}},[a("note-card",{attrs:{title:"已拥有的角色",shadow:"",actions:t.titleRole()}},[a("div",{staticStyle:{height:"240px","overflow-y":"auto"}},[a("base-table",{attrs:{"data-source":t.hasRoleList,loading:t.loading,columns:t.columnsRole(),"border-style":!1}})],1)])],1)],1),a("note-card",{staticClass:"info-wrap user-data-auth",attrs:{title:"岗位与数据权限",shadow:""}},[a("div",{staticClass:"dataAuth"},[a("el-row",[a("el-col",{attrs:{span:4}},[a("Tabs",{attrs:{"tab-list":t.postList,"tab-active":t.tabActive,"tab-position":"left"},on:{tabClick:t.handleClick}})],1),a("el-col",{attrs:{span:20}},[a("dataAuthFilter",{attrs:{dataAuths:t.dataAuths}})],1)],1)],1)])],1),a("simple-dialog",{attrs:{"dialog-title":"用户授权","dialog-visible":t.roleAuthVisible,"dialog-width":"400px","save-text":"确 定","cancel-text":"取 消","botton-show":"true"},on:{"update:dialogVisible":function(e){t.roleAuthVisible=e},"update:dialog-visible":function(e){t.roleAuthVisible=e},saveEmit:t.submitRoleAuth,cancelEmit:t.cancelRoleAuth}},[a("base-table",{ref:"roleListBaseTable",attrs:{"data-source":t.unHasRoles,loading:t.roleLoading,columns:t.allRolesColumns,height:"300","border-style":!0},on:{selectionChange:t.roleAuthSelection}})],1),a("roleDialog",{ref:"child",attrs:{roleOperType:t.roleOperType}})],1)},s=[],l=(a("99af"),a("4de4"),a("4160"),a("caad"),a("d81d"),a("a434"),a("159b"),a("2909")),n=(a("0644"),a("4b25")),o=a("d547"),r=a("fd85"),d=a("cb9b"),c=a("ddec"),u=a("7b6d"),h={name:"UserInfoDetail",components:{dataAuthFilter:u["a"],roleDialog:c["a"]},mixins:[n["a"]],data:function(){return{defaultProps:{children:"children",label:"title"},tabActive:"",tabPosition:"left",menus:[],actionFlag:{},userInfos:{username:"--"},hasRoleList:[],unHasRoles:[],postList:[],authList:[],roleAuthVisible:!1,titleRole:function(){var t=this;return[{title:"添加角色",icon:"add-line",onClick:t.roleAuth}]},columnsRole:function(){var t=this;return[{prop:"name",label:"角色名称","header-align":"left",showOverflowTooltip:!0,"min-width":"120"},{prop:"",label:"操作",align:"center","min-width":"100",actions:[{code:"detail",text:"查看详情",onClick:t.roleDetail},{code:"del",text:"删除",onClick:t.roleDel}]}]},allRolesColumns:[{type:"selection",width:55},{prop:"name",label:"角色名称","header-align":"left",showOverflowTooltip:!0,"min-width":"100"},{prop:"description",label:"角色描述","header-align":"left",showOverflowTooltip:!0,"min-width":"160"}],userTrees:[],dataViewId:"",primaryKeys:"",type:"",rule:"",roleIds:[],roleOperType:"2",roleAuthDialog:function(){return[{prop:"",type:"selection",align:"center","min-width":"55"},{prop:"name",label:"角色名称",align:"center",showOverflowTooltip:!0,"min-width":"100"}]},dataAuths:{dataViewId:"",rule:[],primaryKeys:"",type:0}}},created:function(){this.rolePageSize=1e4,this.userDetailQuery(),this.getRoleList(),this.userAuth()},methods:{userDetailQuery:function(){var t=this;Object(r["p"])(this.$route.query.id).then((function(e){var a=e.data,i=e.error;i?t.$message.error(i.message):(t.userInfos=a,t.hasRoleList=a.roles,t.postList=a.stations,a.stations&&a.stations.length>0&&(t.tabActive=t.postList[0].id,t.iniDataAuthDetail(t.tabActive)))}))},roleAuth:function(t){this.filterUnHasRole(),this.roleAuthVisible=!0},filterUnHasRole:function(){var t=this;this.unHasRoles=this.roleList.filter((function(e){return void 0===Object(o["b"])(t.hasRoleList,"id",e.id)}))},roleAuthSelection:function(t){this.roleIds=t},submitRoleAuth:function(){var t=this,e=[].concat(Object(l["a"])(this.roleIds),Object(l["a"])(this.hasRoleList));Object(r["M"])(this.$route.query.id,{roles:e.map((function(t){return t.id}))}).then((function(a){var i=a.error;i?t.$message.error({title:"失败",message:"用户角色授权失败：".concat(i.message)}):(t.$message.success({title:"成功",message:" 用户角色授权成功"}),t.userAuth(),t.hasRoleList=e,t.roleAuthVisible=!1)}))},cancelRoleAuth:function(){this.roleAuthVisible=!1},dataViewQueryTwo:function(t){var e=this;Object(d["f"])({viewId:t}).then((function(t){var a=t.data;e.authList=a.rows}))},proMsg:function(t){this.selectType=t},handleClick:function(t){this.tabActive=t,this.iniDataAuthDetail()},iniDataAuthDetail:function(){var t=this;this.dataAuths={dataViewId:"",rule:[],primaryKeys:"",type:0};var e=Object(o["b"])(this.postList,"id",this.tabActive);e.dataGroupId&&Object(r["g"])(e.dataGroupId).then((function(e){var a=e.data,i=e.error;i?t.$message.error("error",i.message):t.dataAuths=a}))},roleDel:function(t,e){var a=this,i=[];this.hasRoleList.forEach((function(e,a){i.push(e.id),i.includes(t.id)&&i.splice(a,1)})),this.$confirm("确定要删除用户拥有的角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){Object(r["M"])(a.$route.query.id,{roles:i}).then((function(t){var i=t.error;i?a.$message.error({title:"失败",message:"删除失败：".concat(i.message)}):(a.hasRoleList.splice(e,1),a.$message.success("操作成功"),a.userAuth())}))}))},roleDetail:function(t){this.roleOperType="2",this.$refs.child.showAddInfo(!0,t,this.roleOperType)},userAuth:function(){var t=this;Object(r["L"])({id:this.$route.query.id}).then((function(e){var a=e.data,i=e.error;i||(t.userTrees=a)}))}}},p=h,f=(a("9c5d"),a("2877")),b=Object(f["a"])(p,i,s,!1,null,null,null);e["default"]=b.exports},7930:function(t,e,a){},"7b6d":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.writable||t.dataViewId?a("div",{staticClass:"data-auth-filter"},[a("div",{staticClass:"labelTitle"},[a("span",[t._v("数据筛选方式：")]),a("el-radio-group",{attrs:{disabled:!t.writable},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[a("el-radio",{attrs:{label:1}},[t._v("阈值筛选")]),a("el-radio",{attrs:{label:0}},[t._v("直接筛选")])],1)],1),1===t.type?a("div",[a("decisionRuleEditor",{ref:"rule",attrs:{dataView:t.dataViewId,viewList:t.dataViewList,rule:t.rule}})],1):a("div",[a("div",{staticClass:"data-view-filter"},[a("div",{staticClass:"labelTitle"},[a("span",[t._v("数据视图：")]),a("el-select",{attrs:{placeholder:"请选择",disabled:!t.writable},on:{change:t.queryChange},model:{value:t.dataViewId,callback:function(e){t.dataViewId=e},expression:"dataViewId"}},t._l(t.dataViewList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)])]),t.dataContents.length>0?a("div",{staticClass:"data-contents"},[a("base-table",{ref:"multipleTable",staticClass:"sortTable",attrs:{border:"","data-source":t.dataContents,loading:t.loading,columns:t.dataColumns,"show-summary":!1,"border-style":!0,height:"320"},on:{selectionChange:t.handleDataSelection}})],1):t._e()]):t._e()},s=[],l=(a("4de4"),a("4160"),a("a15b"),a("d81d"),a("ac1f"),a("1276"),a("159b"),a("d4ec")),n=a("bee2"),o=a("262e"),r=a("2caf"),d=a("9ab4"),c=a("60a3"),u=a("ca00"),h=a("cb9b"),p=a("229b"),f=function(t){Object(o["a"])(a,t);var e=Object(r["a"])(a);function a(){var t;return Object(l["a"])(this,a),t=e.apply(this,arguments),t.type=0,t.dataViewId="",t.primaryKeys="",t.rule=[],t.selections=[],t.primaryCode="",t.innerUpdateFlag=!1,t.loading=!1,t.dataViewList=[],t.dataColumns=[],t.dataContents=[],t}return Object(n["a"])(a,[{key:"created",value:function(){this.getViewDataOptions(),this.dataContent.length<1&&(this.dataContents=[])}},{key:"watchDataUpate",value:function(t,e){var a=this;t&&t.dataViewId||e&&e.dataViewId?(this.dataViewId=t.dataViewId,this.type=t.type,this.primaryKeys=t.primaryKeys,this.rule=t.rule,(t.dataViewId||e.dataViewId)&&(this.getViewDataOptions(),t.dataViewId&&setTimeout((function(){a.queryChange(t.dataViewId)}),500))):(this.dataColumns=[],this.dataContents=[],this.dataViewId="")}},{key:"getViewDataOptions",value:function(){var t=this;Object(h["e"])({dictFlag:"0"}).then((function(e){var a=e.data,i=e.error;i||(t.dataViewList=a)}))}},{key:"queryChange",value:function(t){var e=this;if(this.dataViewList&&this.dataViewList.length>0){var a=Object(u["a"])(this.dataViewList,"id",t).fields;this.dataContents=[],this.dataColumns=a.map((function(t){return 0===t.isPrimaryKey&&(e.primaryCode=t.fieldCode),{prop:t.fieldCode,label:t.fieldName,"header-align":"left",showOverflowTooltip:!0,"min-width":"120",fieldType:t.fieldType}})),0===this.type&&(this.dataColumns.unshift({type:"selection",width:40,fixed:!0}),this.writable||(this.dataColumns[0].selectable=function(){return!1})),this.loading=!0,Object(h["f"])({viewId:t}).then((function(t){var a=t.error,i=t.data;e.loading=!1,a?e.$message.error(a.message):(e.dataContents=i.rows,0===e.type&&e.initSelection())}))}}},{key:"handleDataSelection",value:function(t){this.innerUpdateFlag||(this.selections=t)}},{key:"initSelection",value:function(){var t=this;this.primaryKeys&&this.$nextTick((function(){t.innerUpdateFlag=!0;var e=t.$refs.multipleTable;t.primaryKeys.split(",").forEach((function(a){var i=Object(u["a"])(t.dataContents,t.primaryCode,a);e.toggleRowSelection(i,!0),t.selections.push(i)})),t.innerUpdateFlag=!1}))}},{key:"getCurrentDataAuths",value:function(){var t=this;return{dataViewId:this.dataViewId,rule:this.rule,primaryKeys:this.selections.filter((function(t){return t})).map((function(e){return e[t.primaryCode]})).join(","),type:this.type}}},{key:"clearEmpty",value:function(){this.dataContents=[]}}]),a}(c["e"]);Object(d["a"])([Object(c["c"])({default:{}})],f.prototype,"dataAuths",void 0),Object(d["a"])([Object(c["c"])({default:!1})],f.prototype,"writable",void 0),Object(d["a"])([Object(c["c"])({default:[]})],f.prototype,"dataContent",void 0),Object(d["a"])([Object(c["f"])("dataAuths")],f.prototype,"watchDataUpate",null),f=Object(d["a"])([Object(c["a"])({components:{decisionRuleEditor:p["a"]}})],f);var b=f,v=b,m=(a("4fee"),a("2877")),w=Object(m["a"])(v,i,s,!1,null,"036cae34",null);e["a"]=w.exports},"9c5d":function(t,e,a){"use strict";var i=a("d5c2"),s=a.n(i);s.a},d5c2:function(t,e,a){}}]);
//# sourceMappingURL=chunk-6a850335.a2c38299.js.map