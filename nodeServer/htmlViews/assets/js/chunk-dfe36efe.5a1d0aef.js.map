{"version":3,"sources":["webpack:///./src/views/viewDateManagent/dataBaseView.vue?2ab5","webpack:///./src/views/viewDateManagent/dataBaseView.vue?33e9","webpack:///./src/views/viewDateManagent/dataBaseView.vue","webpack:///./src/views/viewDateManagent/dataBaseView.vue?c704","webpack:///./src/views/viewDateManagent/dataBaseView.vue?54f3"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","directives","name","rawName","value","expression","attrs","actionsView","ref","form","rules","model","callback","$$v","$set","_l","item","key","id","on","setConnector","_v","staticStyle","paramsActions","isCompatible","parameterData","dictFlag","fieldTableData","sqlList","rows","loading","headers","dialogVisibleData","saveDialog","cancelDialog","dialogSwitch","treeDataTest","cancelSwitch","staticRenderFns","code","type","required","defaultValue","addButton","edits","updateId","connectorData","connectorList","text","linkId","sql","message","trigger","treeField","testloading","dialogVisible","listData","_this","icon","onClick","setDetermines","title","canelDetermines","testChange","record","undefined","length","$refs","validate","valid","params","testQuery","$message","error","then","res","success","data","list","testList","codeList","Object","keys","map","oriField","push","label","fieldName","prop","fieldCode","fieldType","spreadQuery","advance","i","typeIndex","items","forEach","index","queryParams","linkQuery","checkFlag","treeLists","parameViewTable","kind","fields","viewData","$router","back","page","limit","$route","query","foreignFieldCode","treeCode","dataViewDetail","components","testEditor","treeTableList","parameView","createDialog","component"],"mappings":"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","file":"assets/js/chunk-dfe36efe.5a1d0aef.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--8-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dataBaseView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--8-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dataBaseView.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dataBaseView\"},[_c('base-panel',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.testloading),expression:\"testloading\"}],attrs:{\"title\":\"数据库型数据视图\",\"actions\":_vm.actionsView()}},[_c('el-form',{ref:\"form\",staticClass:\"formCss labelSuffix\",attrs:{\"model\":_vm.form,\"rules\":_vm.rules,\"label-position\":\"left\",\"label-suffix\":\"：\",\"label-width\":\"110px\"}},[_c('el-form-item',{attrs:{\"label\":\"视图名称\",\"prop\":\"name\"}},[_c('el-input',{attrs:{\"clearable\":\"\",\"placeholder\":\"请输入视图名称\"},model:{value:(_vm.form.name),callback:function ($$v) {_vm.$set(_vm.form, \"name\", $$v)},expression:\"form.name\"}})],1),_c('el-form-item',{attrs:{\"label\":\"数据源连接器\",\"clearable\":\"\",\"prop\":\"linkId\"}},[_c('el-select',{attrs:{\"filterable\":\"\",\"placeholder\":\"请选择连接器\"},model:{value:(_vm.form.linkId),callback:function ($$v) {_vm.$set(_vm.form, \"linkId\", $$v)},expression:\"form.linkId\"}},_vm._l((_vm.connectorData),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.name,\"value\":item.id}})}),1),_c('el-button',{staticClass:\"create_button\",attrs:{\"icon\":\"el-icon-plus\"},on:{\"click\":_vm.setConnector}},[_vm._v(\"新增\")])],1),_c('el-form-item',{attrs:{\"label\":\"SQL脚本\",\"prop\":\"sql\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"placeholder\":\"请输入\"},model:{value:(_vm.form.sql),callback:function ($$v) {_vm.$set(_vm.form, \"sql\", $$v)},expression:\"form.sql\"}})],1),_c('el-form-item',{staticStyle:{\"padding-left\":\"10px\"},attrs:{\"label\":\"数据字典\",\"label-width\":\"100px\",\"prop\":\"dictFlag\"}},[_c('el-switch',{attrs:{\"active-value\":0,\"inactive-value\":1},model:{value:(_vm.form.dictFlag),callback:function ($$v) {_vm.$set(_vm.form, \"dictFlag\", $$v)},expression:\"form.dictFlag\"}})],1)],1),_c('simple-card',{attrs:{\"actions\":_vm.paramsActions(),\"title\":\"参数列表\"}},[_c('parameView',{ref:\"parameViewTable\",attrs:{\"isCompatible\":_vm.isCompatible,\"parameterData\":_vm.parameterData,\"dictFlag\":_vm.form.dictFlag}})],1),_c('simple-card',{attrs:{\"title\":\"字段列表\"}},[_c('treeTableList',{ref:\"treeLists\",attrs:{\"isCompatible\":_vm.isCompatible,\"data-list\":_vm.fieldTableData}})],1),_c('simple-card',{attrs:{\"title\":\"测试查询结果预览\"}},[_c('base-table',{staticClass:\"sortTable\",attrs:{\"border\":\"\",\"data-source\":_vm.sqlList.rows,\"loading\":_vm.loading,\"columns\":_vm.sqlList.headers,\"show-summary\":false,\"border-style\":true}})],1)],1),_c('createDialog',{attrs:{\"dialog-title\":\"新建数据库连接器\",\"dialog-visible\":_vm.dialogVisibleData,\"dialog-width\":\"500px\",\"botton-show\":\"true\",\"type\":\"0\",\"save-text\":\"保存\",\"cancel-text\":\"取消\"},on:{\"saveEmit\":_vm.saveDialog,\"cancelEmit\":_vm.cancelDialog}}),_c('testEditor',{ref:\"advance\",attrs:{\"dialog-test-switch\":_vm.dialogSwitch,\"params-list\":_vm.parameterData},on:{\"saveEmitSwitch\":_vm.treeDataTest,\"cancelEmitSwitch\":_vm.cancelSwitch}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue } from 'vue-property-decorator';\r\nimport { Form } from 'element-ui';\r\nimport { arrayFind } from '@utils/util';\r\nimport testEditor from './component/editTest.vue';\r\nimport treeTableList from './component/treeTableList.vue';\r\nimport { statementChange } from './component/conditional.js';\r\nimport createDialog from './component/createDialog.vue';\r\nimport parameView from './component/parameView.vue';\r\nimport {\r\n  linkList,\r\n  addCombin,\r\n  testQuery,\r\n  dataViewAdd,\r\n  viewDataEdit,\r\n  dataViewDetail\r\n} from '@api/viewData';\r\n\r\n@Component({\r\n  components: { testEditor, treeTableList, parameView, createDialog }\r\n})\r\nexport default class DataBaseView extends Vue {\r\n  private parameterData: Array<any> = [\r\n    // 参数表格\r\n    {\r\n      id: 1,\r\n      code: '',\r\n      name: '',\r\n      type: '',\r\n      required: '',\r\n      defaultValue: '',\r\n      addButton: true,\r\n      edits: [0, 1, 1, 1, 1, 1, 0]\r\n    }\r\n  ];\r\n  private isCompatible: any = '';\r\n  private updateId: any = '';\r\n  private connectorData: Array<any> = []; // 连接器列表\r\n  private fieldTableData: Array<any> = []; // 字段表格\r\n  private connectorList: Array<any> = [\r\n    {\r\n      text: 'oracle',\r\n      value: 0\r\n    },\r\n    {\r\n      text: 'mysql',\r\n      value: 1\r\n    }\r\n  ];\r\n  private form: any = {\r\n    name: '',\r\n    linkId: '',\r\n    sql: '',\r\n    dictFlag: 1\r\n  };\r\n  private rules: any = {\r\n    name: [{ required: true, message: '请输入视图名称', trigger: 'blur' }],\r\n    linkId: [\r\n      { required: true, message: '请选择数据源连接器', trigger: 'change' }\r\n    ],\r\n    sql: [{ required: true, message: '请输入查询脚本', trigger: 'blur' }]\r\n  };\r\n  private treeField: any = {};\r\n  private sqlList: any = {\r\n    headers: [],\r\n    rows: []\r\n  };\r\n  private testloading = false;\r\n  private dialogVisible = false;\r\n  private dialogVisibleData = false;\r\n  private dialogSwitch = false;\r\n  actionsView() {\r\n    const _this = this;\r\n    return [\r\n      {\r\n        icon: '',\r\n        onClick: _this.setDetermines,\r\n        type: 'primary',\r\n        title: '确定'\r\n      },\r\n      {\r\n        icon: '',\r\n        onClick: _this.canelDetermines,\r\n        type: 'button',\r\n        title: '取消'\r\n      }\r\n    ];\r\n  }\r\n  private listData: Array<any> = [];\r\n  paramsActions() {\r\n    const _this = this;\r\n    return [\r\n      {\r\n        title: '测试查询',\r\n        icon: 'stack-line',\r\n        onClick: _this.testChange\r\n      }\r\n    ];\r\n  }\r\n  // 关联字段设置\r\n  setFiled(record: object) {\r\n    this.dialogVisible = true;\r\n    this.treeField = record;\r\n  }\r\n  // 判断参数对象里面有没有空值\r\n  deleteEmptyParam(value: any) {\r\n    for (const key in value) {\r\n      if (\r\n        value[key] === '' ||\r\n        value[key] === null ||\r\n        value[key] === undefined ||\r\n        value[key] === [] ||\r\n        value[key].length === 0\r\n      ) {\r\n        delete value[key];\r\n      }\r\n    }\r\n  }\r\n  // 测试查询\r\n  testChange() {\r\n    (this.$refs['form'] as Form).validate((valid) => {\r\n      if (valid) {\r\n        if (this.parameterData.length > 0 && this.parameterData[0].code) {\r\n          this.dialogSwitch = true;\r\n        } else {\r\n          const params = {\r\n            linkId: this.form.linkId,\r\n            sql: this.form.sql\r\n          };\r\n          this.testQuery(params);\r\n        }\r\n      } else {\r\n        this.$message.error('请先完成基本信息输入！');\r\n      }\r\n    });\r\n  }\r\n  testQuery(params: any) {\r\n    this.testloading = true;\r\n    testQuery(params).then((res) => {\r\n      this.dialogSwitch = false;\r\n      this.testloading = false;\r\n      if (!res.error) {\r\n        this.$message.success('测试查询成功');\r\n        if (res.data.rows) {\r\n          this.sqlList.rows = res.data.rows;\r\n          const list = res.data.rows;\r\n          const testList: Array<any> = [];\r\n          const codeList: Array<any> = [];\r\n          Object.keys(list[0]).map((item) => {\r\n            const oriField = arrayFind(this.fieldTableData, 'fieldCode', item);\r\n            if (!oriField) {\r\n              testList.push({\r\n                label: item,\r\n                prop: item\r\n              });\r\n              codeList.push({\r\n                fieldCode: item,\r\n                fieldName: '',\r\n                fieldType: ''\r\n              });\r\n            } else {\r\n              codeList.push(oriField);\r\n              testList.push({\r\n                label: oriField.fieldName,\r\n                prop: item\r\n              });\r\n            }\r\n          });\r\n          this.sqlList.headers = testList;\r\n          this.fieldTableData = codeList;\r\n        }\r\n      } else {\r\n        this.$message.error(res.error.message);\r\n      }\r\n    });\r\n  }\r\n  // 测试查询-保存\r\n  treeDataTest() {\r\n    let spreadQuery: Array<any> = [];\r\n    if (this.$refs.advance['spread'].model) {\r\n      for (const i in this.$refs.advance['spread'].model) {\r\n        let typeIndex = '';\r\n        this.$refs.advance['spread'].items.forEach((item, index) => {\r\n          if (i === item.key) {\r\n            typeIndex = item.type;\r\n          }\r\n        });\r\n        spreadQuery.push({\r\n          code: i,\r\n          value: this.$refs.advance['spread'].model[i],\r\n          type: typeIndex\r\n        });\r\n      }\r\n    } else {\r\n      spreadQuery = [];\r\n    }\r\n    const params = {\r\n      linkId: this.form.linkId,\r\n      sql: this.form.sql,\r\n      queryParams: spreadQuery\r\n    };\r\n    this.testQuery(params);\r\n  }\r\n  cancelSwitch() {\r\n    this.dialogSwitch = false;\r\n    this.$refs.advance['spread'].model = '';\r\n  }\r\n  // 新增-数据库\r\n  saveDialog(params) {\r\n    addCombin(params).then(({ error }: any) => {\r\n      if (!error) {\r\n        this.$message.success('新增成功！');\r\n        this.dialogVisibleData = false;\r\n        this.linkQuery();\r\n        this.cancelDialog();\r\n      } else {\r\n        this.$message.error(error.message);\r\n      }\r\n    });\r\n  }\r\n  // 取消-数据库\r\n  cancelDialog() {\r\n    this.dialogVisibleData = false;\r\n  }\r\n  // 新建数据库\r\n  setConnector() {\r\n    this.dialogVisibleData = true;\r\n  }\r\n  // 确定\r\n  setDetermines() {\r\n    (this.$refs['form'] as Form).validate((valid) => {\r\n      let checkFlag: any = '';\r\n      if (valid) {\r\n        this.fieldTableData = this.$refs.treeLists['treeDataList'];\r\n        this.parameterData = this.$refs.parameViewTable['parameterData'];\r\n        checkFlag = statementChange(this.parameterData, this.fieldTableData);\r\n        if (checkFlag === false) {\r\n          const params: any = {\r\n            ...this.form,\r\n            type: 0,\r\n            kind: 0,\r\n            fields: this.fieldTableData\r\n          };\r\n          if (this.parameterData.length > 0 && this.parameterData[0].code) {\r\n            params.queryParams = this.parameterData;\r\n          } else {\r\n            params.queryParams = [];\r\n          }\r\n          if (\r\n            (this.isCompatible === '0' && this.updateId) ||\r\n            (this.isCompatible === '1' && this.updateId)\r\n          ) {\r\n            params.id = this.updateId;\r\n            params.isCompatible = this.isCompatible;\r\n            viewDataEdit(params).then(({ data, error }) => {\r\n              if (!error) {\r\n                this.$message.success('保存成功');\r\n                this.$router.back();\r\n              } else {\r\n                this.$message.error('保存失败:' + error.message);\r\n              }\r\n            });\r\n          } else {\r\n            dataViewAdd(params).then(({ data, error }) => {\r\n              if (!error) {\r\n                this.$message.success('保存成功');\r\n                this.$router.back();\r\n              } else {\r\n                this.$message.error('保存失败:' + error.message);\r\n              }\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  canelDetermines() {\r\n    this.$router.push('/sysSupport/dataService/viewDateManagent');\r\n  }\r\n  linkQuery() {\r\n    linkList({\r\n      page: 1,\r\n      limit: 10000,\r\n      type: '0'\r\n    }).then(({ data }: any) => {\r\n      this.connectorData = data.rows;\r\n    });\r\n  }\r\n  // 数据视图详情接口\r\n  dataViewDetail() {\r\n    this.isCompatible = this.$route.query.isCompatible;\r\n    this.updateId = this.$route.query.id;\r\n    const id = this.$route.query.id;\r\n    dataViewDetail(id).then(({ data }: any) => {\r\n      this.form.name = data.name;\r\n      this.form.linkId = data.linkId;\r\n      this.form.sql = data.sql;\r\n      this.form.dictFlag = data.dictFlag;\r\n      if (data.queryParams) {\r\n        this.parameterData = data.queryParams;\r\n      }\r\n      data.fields.forEach((item) => {\r\n        if (item.foreignFieldCode) {\r\n          item.treeCode = true;\r\n        }\r\n      });\r\n      this.fieldTableData = data.fields;\r\n    });\r\n  }\r\n  // 数据初始化\r\n  created() {\r\n    const id = this.$route.query.id;\r\n    if (id) {\r\n      this.dataViewDetail();\r\n    }\r\n    this.linkQuery();\r\n  }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dataBaseView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dataBaseView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./dataBaseView.vue?vue&type=template&id=462ea860&\"\nimport script from \"./dataBaseView.vue?vue&type=script&lang=ts&\"\nexport * from \"./dataBaseView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./dataBaseView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}