(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dfe36efe"],{"365d":function(e,a,t){"use strict";var i=t("8bc2"),r=t.n(i);r.a},"8bc2":function(e,a,t){},"962d":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"dataBaseView"},[t("base-panel",{directives:[{name:"loading",rawName:"v-loading",value:e.testloading,expression:"testloading"}],attrs:{title:"数据库型数据视图",actions:e.actionsView()}},[t("el-form",{ref:"form",staticClass:"formCss labelSuffix",attrs:{model:e.form,rules:e.rules,"label-position":"left","label-suffix":"：","label-width":"110px"}},[t("el-form-item",{attrs:{label:"视图名称",prop:"name"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入视图名称"},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"数据源连接器",clearable:"",prop:"linkId"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择连接器"},model:{value:e.form.linkId,callback:function(a){e.$set(e.form,"linkId",a)},expression:"form.linkId"}},e._l(e.connectorData,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-button",{staticClass:"create_button",attrs:{icon:"el-icon-plus"},on:{click:e.setConnector}},[e._v("新增")])],1),t("el-form-item",{attrs:{label:"SQL脚本",prop:"sql"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入"},model:{value:e.form.sql,callback:function(a){e.$set(e.form,"sql",a)},expression:"form.sql"}})],1),t("el-form-item",{staticStyle:{"padding-left":"10px"},attrs:{label:"数据字典","label-width":"100px",prop:"dictFlag"}},[t("el-switch",{attrs:{"active-value":0,"inactive-value":1},model:{value:e.form.dictFlag,callback:function(a){e.$set(e.form,"dictFlag",a)},expression:"form.dictFlag"}})],1)],1),t("simple-card",{attrs:{actions:e.paramsActions(),title:"参数列表"}},[t("parameView",{ref:"parameViewTable",attrs:{isCompatible:e.isCompatible,parameterData:e.parameterData,dictFlag:e.form.dictFlag}})],1),t("simple-card",{attrs:{title:"字段列表"}},[t("treeTableList",{ref:"treeLists",attrs:{isCompatible:e.isCompatible,"data-list":e.fieldTableData}})],1),t("simple-card",{attrs:{title:"测试查询结果预览"}},[t("base-table",{staticClass:"sortTable",attrs:{border:"","data-source":e.sqlList.rows,loading:e.loading,columns:e.sqlList.headers,"show-summary":!1,"border-style":!0}})],1)],1),t("createDialog",{attrs:{"dialog-title":"新建数据库连接器","dialog-visible":e.dialogVisibleData,"dialog-width":"500px","botton-show":"true",type:"0","save-text":"保存","cancel-text":"取消"},on:{saveEmit:e.saveDialog,cancelEmit:e.cancelDialog}}),t("testEditor",{ref:"advance",attrs:{"dialog-test-switch":e.dialogSwitch,"params-list":e.parameterData},on:{saveEmitSwitch:e.treeDataTest,cancelEmitSwitch:e.cancelSwitch}})],1)},r=[],s=(t("4160"),t("d81d"),t("b0c0"),t("b64b"),t("159b"),t("5530")),l=t("d4ec"),o=t("bee2"),n=t("262e"),c=t("2caf"),d=t("9ab4"),u=t("60a3"),m=t("ca00"),f=t("7504"),p=t("d7e7"),b=t("5b71"),v=t("1e45"),h=t("12ec"),g=t("cb9b"),y=function(e){Object(n["a"])(t,e);var a=Object(c["a"])(t);function t(){var e;return Object(l["a"])(this,t),e=a.apply(this,arguments),e.parameterData=[{id:1,code:"",name:"",type:"",required:"",defaultValue:"",addButton:!0,edits:[0,1,1,1,1,1,0]}],e.isCompatible="",e.updateId="",e.connectorData=[],e.fieldTableData=[],e.connectorList=[{text:"oracle",value:0},{text:"mysql",value:1}],e.form={name:"",linkId:"",sql:"",dictFlag:1},e.rules={name:[{required:!0,message:"请输入视图名称",trigger:"blur"}],linkId:[{required:!0,message:"请选择数据源连接器",trigger:"change"}],sql:[{required:!0,message:"请输入查询脚本",trigger:"blur"}]},e.treeField={},e.sqlList={headers:[],rows:[]},e.testloading=!1,e.dialogVisible=!1,e.dialogVisibleData=!1,e.dialogSwitch=!1,e.listData=[],e}return Object(o["a"])(t,[{key:"actionsView",value:function(){var e=this;return[{icon:"",onClick:e.setDetermines,type:"primary",title:"确定"},{icon:"",onClick:e.canelDetermines,type:"button",title:"取消"}]}},{key:"paramsActions",value:function(){var e=this;return[{title:"测试查询",icon:"stack-line",onClick:e.testChange}]}},{key:"setFiled",value:function(e){this.dialogVisible=!0,this.treeField=e}},{key:"deleteEmptyParam",value:function(e){for(var a in e)""!==e[a]&&null!==e[a]&&void 0!==e[a]&&e[a]!==[]&&0!==e[a].length||delete e[a]}},{key:"testChange",value:function(){var e=this;this.$refs["form"].validate((function(a){if(a)if(e.parameterData.length>0&&e.parameterData[0].code)e.dialogSwitch=!0;else{var t={linkId:e.form.linkId,sql:e.form.sql};e.testQuery(t)}else e.$message.error("请先完成基本信息输入！")}))}},{key:"testQuery",value:function(e){var a=this;this.testloading=!0,Object(g["r"])(e).then((function(e){if(a.dialogSwitch=!1,a.testloading=!1,e.error)a.$message.error(e.error.message);else if(a.$message.success("测试查询成功"),e.data.rows){a.sqlList.rows=e.data.rows;var t=e.data.rows,i=[],r=[];Object.keys(t[0]).map((function(e){var t=Object(m["a"])(a.fieldTableData,"fieldCode",e);t?(r.push(t),i.push({label:t.fieldName,prop:e})):(i.push({label:e,prop:e}),r.push({fieldCode:e,fieldName:"",fieldType:""}))})),a.sqlList.headers=i,a.fieldTableData=r}}))}},{key:"treeDataTest",value:function(){var e=this,a=[];if(this.$refs.advance["spread"].model){var t=function(t){var i="";e.$refs.advance["spread"].items.forEach((function(e,a){t===e.key&&(i=e.type)})),a.push({code:t,value:e.$refs.advance["spread"].model[t],type:i})};for(var i in this.$refs.advance["spread"].model)t(i)}else a=[];var r={linkId:this.form.linkId,sql:this.form.sql,queryParams:a};this.testQuery(r)}},{key:"cancelSwitch",value:function(){this.dialogSwitch=!1,this.$refs.advance["spread"].model=""}},{key:"saveDialog",value:function(e){var a=this;Object(g["a"])(e).then((function(e){var t=e.error;t?a.$message.error(t.message):(a.$message.success("新增成功！"),a.dialogVisibleData=!1,a.linkQuery(),a.cancelDialog())}))}},{key:"cancelDialog",value:function(){this.dialogVisibleData=!1}},{key:"setConnector",value:function(){this.dialogVisibleData=!0}},{key:"setDetermines",value:function(){var e=this;this.$refs["form"].validate((function(a){var t="";if(a&&(e.fieldTableData=e.$refs.treeLists["treeDataList"],e.parameterData=e.$refs.parameViewTable["parameterData"],t=Object(b["a"])(e.parameterData,e.fieldTableData),!1===t)){var i=Object(s["a"])(Object(s["a"])({},e.form),{},{type:0,kind:0,fields:e.fieldTableData});e.parameterData.length>0&&e.parameterData[0].code?i.queryParams=e.parameterData:i.queryParams=[],"0"===e.isCompatible&&e.updateId||"1"===e.isCompatible&&e.updateId?(i.id=e.updateId,i.isCompatible=e.isCompatible,Object(g["t"])(i).then((function(a){a.data;var t=a.error;t?e.$message.error("保存失败:"+t.message):(e.$message.success("保存成功"),e.$router.back())}))):Object(g["c"])(i).then((function(a){a.data;var t=a.error;t?e.$message.error("保存失败:"+t.message):(e.$message.success("保存成功"),e.$router.back())}))}}))}},{key:"canelDetermines",value:function(){this.$router.push("/sysSupport/dataService/viewDateManagent")}},{key:"linkQuery",value:function(){var e=this;Object(g["o"])({page:1,limit:1e4,type:"0"}).then((function(a){var t=a.data;e.connectorData=t.rows}))}},{key:"dataViewDetail",value:function(){var e=this;this.isCompatible=this.$route.query.isCompatible,this.updateId=this.$route.query.id;var a=this.$route.query.id;Object(g["d"])(a).then((function(a){var t=a.data;e.form.name=t.name,e.form.linkId=t.linkId,e.form.sql=t.sql,e.form.dictFlag=t.dictFlag,t.queryParams&&(e.parameterData=t.queryParams),t.fields.forEach((function(e){e.foreignFieldCode&&(e.treeCode=!0)})),e.fieldTableData=t.fields}))}},{key:"created",value:function(){var e=this.$route.query.id;e&&this.dataViewDetail(),this.linkQuery()}}]),t}(u["e"]);y=Object(d["a"])([Object(u["a"])({components:{testEditor:f["a"],treeTableList:p["a"],parameView:h["a"],createDialog:v["a"]}})],y);var k=y,D=k,w=(t("365d"),t("2877")),q=Object(w["a"])(D,i,r,!1,null,null,null);a["default"]=q.exports}}]);
//# sourceMappingURL=chunk-dfe36efe.5a1d0aef.js.map